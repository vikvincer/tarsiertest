!function(a){"use strict";var e=function(a){function e(a,t){babelHelpers.classCallCheck(this,e);var i=babelHelpers.possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a,t));return i.feature="ads",i.inProgress=!1,i.streamManager=null,i.currentAd=null,i.adTimeRemaining=null,i.snapForwardTime=null,i.onAdEvent=i.onAdEvent.bind(i),i.player.mediaTransforms.unshift(function(a){return new Promise(function(e,t){function r(a,e){return o[a]||m[a]||d[a]||e}var n="live"==a.temporalType,s=n?new google.ima.dai.api.LiveStreamRequest:new google.ima.dai.api.VODStreamRequest,m=a.metadata?a.metadata.media||a.metadata:{},d=i.player.evaluateBindings(i.config,{media:a}),o=akamai.amp.Utils.getSourceByType(a,"application/x-mpegURL");if(null==o)return t("Could not find media");if(o=i.player.evaluateBindings(o,{media:a}),s.adTagParameters=r("adTagParameters"),s.streamActivityMonitorId=r("streamActivityMonitorId"),s.apiKey=r("apiKey",""),n){var p=r("assetKey");if(!p)return e(a);s.assetKey=p,s.attemptPreroll=r("attemptPreroll",!0),i.player.addEventListener(akamai.amp.Events.TIMED_METADATA,function(a){var e=a.detail;i.streamManager&&e&&i.streamManager.onTimedMetadata({TXXX:e.value.data})})}else{var l=r("videoId"),E=r("contentSourceId");if(!E)return e(a);s.contentSourceId=E,s.videoId=l}var g=function t(r){switch(i.logger.log("[AMP IMA DAI] Stream Event: "+r.type,r),i.streamManager.removeEventListener([google.ima.dai.api.StreamEvent.Type.LOADED,google.ima.dai.api.StreamEvent.Type.ERROR],t,!1),r.type){case google.ima.dai.api.StreamEvent.Type.LOADED:a.src=r.getStreamData().url,i.logger.log("[AMP IMA DAI] Media Source Fetched "+a.src);break;case google.ima.dai.api.StreamEvent.Type.ERROR:i.logger.log("[AMP IMA DAI] Media Source Fetch Error",r)}e(a)};i.streamManager.addEventListener([google.ima.dai.api.StreamEvent.Type.LOADED,google.ima.dai.api.StreamEvent.Type.ERROR],g,!1),i.streamManager.requestStream(s)})}),i}return babelHelpers.inherits(e,a),babelHelpers.createClass(e,[{key:"onready",value:function(){this.logger.log("[AMP IMA DAI] SDK initialize"),this.streamManager=new google.ima.dai.api.StreamManager(this.player.mediaElement),this.streamManager.setClickElement(this.player.ui.ads.container);var a=[];for(var e in google.ima.dai.api.StreamEvent.Type)google.ima.dai.api.StreamEvent.Type.hasOwnProperty(e)&&a.push(google.ima.dai.api.StreamEvent.Type[e]);this.streamManager.addEventListener(a,this.onAdEvent,!1)}},{key:"onmediachange",value:function(){this.inProgress=!1}},{key:"onAdEvent",value:function(a){switch(this.logger.log("[AMP IMA DAI] Event: "+a.type,a),a.type){case google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED:this.adBreakStart(a);break;case google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED:this.adBreakEnd(a);break;case google.ima.dai.api.StreamEvent.Type.STARTED:this.adStarted(a);break;case google.ima.dai.api.StreamEvent.Type.COMPLETE:this.adEnded(a);break;case google.ima.dai.api.StreamEvent.Type.AD_PROGRESS:this.adProgress(a);break;case google.ima.dai.api.StreamEvent.Type.CLICK:this.adClick(a);break;case google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE:this.adFirstQuartile(a);break;case google.ima.dai.api.StreamEvent.Type.MIDPOINT:this.adMidpoint(a);break;case google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE:this.adThirdQuartile(a);break;case google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED:this.cuePointsChanged(a);break;case google.ima.dai.api.StreamEvent.Type.ERROR:this.adError(a)}}},{key:"adBreakStart",value:function(a){this.inProgress=!0,this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.BREAK_START))}},{key:"adStarted",value:function(a){0==this.inProgress&&this.adBreakStart();var e=a.getAd(),t=e.getCompanionAds(),i=e.getAdPodInfo().getAdPosition(),r=e.getAdPodInfo().getPodIndex(),n=0==r?"preroll":-1==r?"postroll":"midroll";this.currentAd=new akamai.amp.AdVO(e.getAdId(),e.getTitle(),e.getDuration(),i,n,"ima-dai",null,t,null,e,e.getAdPodInfo().getTotalAds()),this.companions=t,this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.LOADED,this.currentAd)),this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.DURATION_CHANGE,this.currentAd)),this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.STARTED,this.currentAd))}},{key:"adFirstQuartile",value:function(a){this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.FIRST_QUARTILE,this.currentAd))}},{key:"adMidpoint",value:function(a){this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.MIDPOINT,this.currentAd))}},{key:"adThirdQuartile",value:function(a){this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.THIRD_QUARTILE,this.currentAd))}},{key:"adEnded",value:function(a){this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.ENDED,this.currentAd))}},{key:"adBreakEnd",value:function(a){this.inProgress=!1,this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.BREAK_END)),this.snapForwardTime&&this.snapForwardTime>this.player.mediaElement.currentTime&&(this.player.mediaElement.currentTime=this.snapForwardTime,this.snapForwardTime=null)}},{key:"adProgress",value:function(a){var e=a.getStreamData().adProgressData,t=e.currentTime,i=e.duration;this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.TIME_UPDATE,t)),this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.TIME_REMAINING,Math.floor(i-t)))}},{key:"adClick",value:function(a){this.player.paused||this.player.pause(),this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.CLICKED,this.currentAd))}},{key:"adError",value:function(a){this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.ERROR,a.getStreamData().errorMessage))}},{key:"cuePointsChanged",value:function(a){var e=this;try{var t=[];a.getStreamData().cuepoints.forEach(function(a){t.push({startTime:e.streamManager.contentTimeForStreamTime(a.start)})}),t.length&&(this.player.cues=t)}catch(a){}}},{key:"onseeked",value:function(a){var e=this.player.mediaElement.currentTime,t=this.streamManager.previousCuePointForStreamTime(e);t&&!t.played&&(this.snapForwardTime=e,this.player.mediaElement.currentTime=t.start)}}]),e}(akamai.amp.AdPlugin);akamai.amp.AMP.registerPlugin("imadai",akamai.amp.Plugin.createFactory(e)),a.DAI=e}(this.akamai.amp.imadai=this.akamai.amp.imadai||{});
//# sourceMappingURL=akamai/amp/imadai/Imadai.min.js.map