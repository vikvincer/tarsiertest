{"version":3,"file":"Imadai.js","sources":["../../../../src/DAI.js","../../../../src/main.js"],"sourcesContent":["//import Timeline from \"./Timeline\"\n\nexport default class DAI extends akamai.amp.AdPlugin {\n  constructor(player, config) {\n    super(player, config)\n\n    this.feature = \"ads\"\n    this.inProgress = false\n    this.streamManager = null\n    this.currentAd = null\n    this.adTimeRemaining = null\n    this.snapForwardTime = null\n\n    this.onAdEvent = this.onAdEvent.bind(this)\n\n    this.player.mediaTransforms.unshift((media) => {\n      return new Promise((resolve, reject) => {\n        // choose the correct request object\n        const isLive = (media.temporalType == \"live\")\n        const streamRequest = (isLive) ? new google.ima.dai.api.LiveStreamRequest() : new google.ima.dai.api.VODStreamRequest()\n\n        // the DAI params can come in from a number of sources\n        const metadata = (media.metadata) ? media.metadata.media || media.metadata : {}\n        const config = this.player.evaluateBindings(this.config, {media})\n        let source = akamai.amp.Utils.getSourceByType(media, \"application/x-mpegURL\")\n        if (source == null)\n          return reject(\"Could not find media\")\n        source = this.player.evaluateBindings(source, {media})\n\n        function getProperty(name, dflt) {\n          return source[name] || metadata[name] || config[name] || dflt\n        }\n\n        // init the stream request\n        streamRequest.adTagParameters = getProperty(\"adTagParameters\")\n        streamRequest.streamActivityMonitorId = getProperty(\"streamActivityMonitorId\")\n        streamRequest.apiKey = getProperty(\"apiKey\", \"\")\n\n        if (isLive) {\n          const assetKey = getProperty(\"assetKey\")\n\n          if (!assetKey)\n            return resolve(media)\n\n          streamRequest.assetKey = assetKey\n          streamRequest.attemptPreroll = getProperty(\"attemptPreroll\", true)\n\n          this.player.addEventListener(akamai.amp.Events.TIMED_METADATA, (event) => {\n            let cue = event.detail\n            if (this.streamManager && cue) {\n              this.streamManager.onTimedMetadata({\"TXXX\": cue.value.data})\n            }\n          })\n        }\n        else {\n          const videoId = getProperty(\"videoId\")\n          const contentSourceId = getProperty(\"contentSourceId\")\n\n          if (!contentSourceId)\n            return resolve(media)\n\n          streamRequest.contentSourceId = contentSourceId\n          streamRequest.videoId = videoId\n        }\n\n        // listen for stream request events\n        let onStreamEvent = (event) => {\n          this.logger.log(`[AMP IMA DAI] Stream Event: ${event.type}`, event)\n          this.streamManager.removeEventListener(\n            [google.ima.dai.api.StreamEvent.Type.LOADED,\n             google.ima.dai.api.StreamEvent.Type.ERROR],\n            onStreamEvent,\n            false)\n\n          switch (event.type) {\n            case google.ima.dai.api.StreamEvent.Type.LOADED:\n              // override the media's src property with the url provided by DAI\n              media.src = event.getStreamData().url\n              //this.player.timeline = new Timeline(this.streamManager, this.player.mediaElement)\n              this.logger.log(`[AMP IMA DAI] Media Source Fetched ${media.src}`)\n              break\n            case google.ima.dai.api.StreamEvent.Type.ERROR:\n              this.logger.log(\"[AMP IMA DAI] Media Source Fetch Error\", event)\n              break\n          }\n          resolve(media)\n        }\n\n        this.streamManager.addEventListener(\n          [google.ima.dai.api.StreamEvent.Type.LOADED,\n           google.ima.dai.api.StreamEvent.Type.ERROR],\n          onStreamEvent,\n          false)\n\n        // make the stream request\n        this.streamManager.requestStream(streamRequest)\n      })\n    })\n  }\n\n  onready() {\n    this.logger.log(\"[AMP IMA DAI] SDK initialize\")\n\n    // create the stream manager\n    this.streamManager = new google.ima.dai.api.StreamManager(this.player.mediaElement)\n    this.streamManager.setClickElement(this.player.ui.ads.container)\n\n    // listen for all available events\n    const events = []\n    for (let event in google.ima.dai.api.StreamEvent.Type) {\n      if (google.ima.dai.api.StreamEvent.Type.hasOwnProperty(event)) {\n        events.push(google.ima.dai.api.StreamEvent.Type[event])\n      }\n    }\n    this.streamManager.addEventListener(events, this.onAdEvent, false)\n  }\n\n  onmediachange() {\n    this.inProgress = false\n  }\n\n  onAdEvent(event) {\n    this.logger.log(`[AMP IMA DAI] Event: ${event.type}`, event)\n    switch (event.type) {\n      case google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED:\n        this.adBreakStart(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED:\n        this.adBreakEnd(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.STARTED:\n        this.adStarted(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.COMPLETE:\n        this.adEnded(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.AD_PROGRESS:\n        this.adProgress(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.CLICK:\n        this.adClick(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE:\n        this.adFirstQuartile(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.MIDPOINT:\n        this.adMidpoint(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE:\n        this.adThirdQuartile(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED:\n        this.cuePointsChanged(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.ERROR:\n        this.adError(event)\n        break\n    }\n  }\n\n  adBreakStart(event) {\n    this.inProgress = true\n    this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.BREAK_START))\n  }\n\n  adStarted(event) {\n    if (this.inProgress == false)\n      this.adBreakStart()\n\n    const ad = event.getAd()\n    const companionAds = ad.getCompanionAds()\n    const adPosition = ad.getAdPodInfo().getAdPosition()\n    const adPodIndex = ad.getAdPodInfo().getPodIndex()\n    const adType = (adPodIndex == 0) ? \"preroll\" : ((adPodIndex == -1) ? \"postroll\" : \"midroll\")\n\n    this.currentAd = new akamai.amp.AdVO(ad.getAdId(), ad.getTitle(), ad.getDuration(), adPosition, adType, \"ima-dai\", null, companionAds, null, ad, ad.getAdPodInfo().getTotalAds())\n    this.companions = companionAds\n    this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.LOADED, this.currentAd))\n    this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.DURATION_CHANGE, this.currentAd))\n    this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.STARTED, this.currentAd))\n  }\n\n  adFirstQuartile(event) {\n    this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.FIRST_QUARTILE, this.currentAd))\n  }\n\n  adMidpoint(event) {\n    this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.MIDPOINT, this.currentAd))\n  }\n\n  adThirdQuartile(event) {\n    this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.THIRD_QUARTILE, this.currentAd))\n  }\n\n  adEnded(event) {\n    this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.ENDED, this.currentAd))\n  }\n\n  adBreakEnd(event) {\n    this.inProgress = false\n    this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.BREAK_END))\n    if (this.snapForwardTime && this.snapForwardTime > this.player.mediaElement.currentTime) {\n      this.player.mediaElement.currentTime = this.snapForwardTime\n      this.snapForwardTime = null\n    }\n  }\n\n  adProgress(event) {\n    const adProgressData = event.getStreamData().adProgressData\n    const currentTime = adProgressData.currentTime\n    const duration = adProgressData.duration\n\n    this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.TIME_UPDATE, currentTime))\n    this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.TIME_REMAINING, Math.floor(duration - currentTime)))\n  }\n\n  adClick(event) {\n    if (!this.player.paused)\n      this.player.pause()\n\n    this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.CLICKED, this.currentAd))\n  }\n\n  adError(event) {\n    this.dispatchEvent(new akamai.amp.Event(akamai.amp.AdEvents.ERROR, event.getStreamData().errorMessage))\n  }\n\n  cuePointsChanged(event) {\n    try {\n      const cues = []\n      event.getStreamData().cuepoints.forEach((cue) => {\n        cues.push({\"startTime\": this.streamManager.contentTimeForStreamTime(cue.start)})\n      })\n      if (cues.length)\n        this.player.cues = cues\n    } catch (error) {}\n  }\n\n  onseeked(event) {\n    const currentTime = this.player.mediaElement.currentTime\n    const previousCuePoint = this.streamManager.previousCuePointForStreamTime(currentTime)\n    if (previousCuePoint && !previousCuePoint.played) {\n      this.snapForwardTime = currentTime\n      this.player.mediaElement.currentTime = previousCuePoint.start\n    }\n  }\n}\n","import DAI from \"./DAI\"\n\nakamai.amp.AMP.registerPlugin(\"imadai\", akamai.amp.Plugin.createFactory(DAI))\n\nexport {DAI}\n"],"names":["DAI","player","config","feature","inProgress","streamManager","currentAd","adTimeRemaining","snapForwardTime","onAdEvent","bind","mediaTransforms","unshift","media","Promise","resolve","reject","isLive","temporalType","streamRequest","google","ima","dai","api","LiveStreamRequest","VODStreamRequest","metadata","evaluateBindings","source","akamai","amp","Utils","getSourceByType","getProperty","name","dflt","adTagParameters","streamActivityMonitorId","apiKey","assetKey","attemptPreroll","addEventListener","Events","TIMED_METADATA","event","cue","detail","onTimedMetadata","value","data","videoId","contentSourceId","onStreamEvent","logger","log","type","removeEventListener","StreamEvent","Type","LOADED","ERROR","src","getStreamData","url","requestStream","StreamManager","mediaElement","setClickElement","ui","ads","container","events","hasOwnProperty","push","AD_BREAK_STARTED","adBreakStart","AD_BREAK_ENDED","adBreakEnd","STARTED","adStarted","COMPLETE","adEnded","AD_PROGRESS","adProgress","CLICK","adClick","FIRST_QUARTILE","adFirstQuartile","MIDPOINT","adMidpoint","THIRD_QUARTILE","adThirdQuartile","CUEPOINTS_CHANGED","cuePointsChanged","adError","dispatchEvent","Event","AdEvents","BREAK_START","ad","getAd","companionAds","getCompanionAds","adPosition","getAdPodInfo","getAdPosition","adPodIndex","getPodIndex","adType","AdVO","getAdId","getTitle","getDuration","getTotalAds","companions","DURATION_CHANGE","ENDED","BREAK_END","currentTime","adProgressData","duration","TIME_UPDATE","TIME_REMAINING","Math","floor","paused","pause","CLICKED","errorMessage","cues","cuepoints","forEach","contentTimeForStreamTime","start","length","error","previousCuePoint","previousCuePointForStreamTime","played","AdPlugin","AMP","registerPlugin","Plugin","createFactory"],"mappings":";;;;;AAAA;;IAEqBA;;;eACPC,MAAZ,EAAoBC,MAApB,EAA4B;;;sHACpBD,MADoB,EACZC,MADY;;UAGrBC,OAAL,GAAe,KAAf;UACKC,UAAL,GAAkB,KAAlB;UACKC,aAAL,GAAqB,IAArB;UACKC,SAAL,GAAiB,IAAjB;UACKC,eAAL,GAAuB,IAAvB;UACKC,eAAL,GAAuB,IAAvB;;UAEKC,SAAL,GAAiB,MAAKA,SAAL,CAAeC,IAAf,OAAjB;;UAEKT,MAAL,CAAYU,eAAZ,CAA4BC,OAA5B,CAAoC,UAACC,KAAD,EAAW;aACtC,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;;YAEhCC,SAAUJ,MAAMK,YAAN,IAAsB,MAAtC;YACMC,gBAAiBF,MAAD,GAAW,IAAIG,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBC,iBAAvB,EAAX,GAAwD,IAAIJ,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBE,gBAAvB,EAA9E;;;YAGMC,WAAYb,MAAMa,QAAP,GAAmBb,MAAMa,QAAN,CAAeb,KAAf,IAAwBA,MAAMa,QAAjD,GAA4D,EAA7E;YACMxB,SAAS,MAAKD,MAAL,CAAY0B,gBAAZ,CAA6B,MAAKzB,MAAlC,EAA0C,EAACW,YAAD,EAA1C,CAAf;YACIe,SAASC,OAAOC,GAAP,CAAWC,KAAX,CAAiBC,eAAjB,CAAiCnB,KAAjC,EAAwC,uBAAxC,CAAb;YACIe,UAAU,IAAd,EACE,OAAOZ,OAAO,sBAAP,CAAP;iBACO,MAAKf,MAAL,CAAY0B,gBAAZ,CAA6BC,MAA7B,EAAqC,EAACf,YAAD,EAArC,CAAT;;iBAESoB,WAAT,CAAqBC,IAArB,EAA2BC,IAA3B,EAAiC;iBACxBP,OAAOM,IAAP,KAAgBR,SAASQ,IAAT,CAAhB,IAAkChC,OAAOgC,IAAP,CAAlC,IAAkDC,IAAzD;;;;sBAIYC,eAAd,GAAgCH,YAAY,iBAAZ,CAAhC;sBACcI,uBAAd,GAAwCJ,YAAY,yBAAZ,CAAxC;sBACcK,MAAd,GAAuBL,YAAY,QAAZ,EAAsB,EAAtB,CAAvB;;YAEIhB,MAAJ,EAAY;cACJsB,WAAWN,YAAY,UAAZ,CAAjB;;cAEI,CAACM,QAAL,EACE,OAAOxB,QAAQF,KAAR,CAAP;;wBAEY0B,QAAd,GAAyBA,QAAzB;wBACcC,cAAd,GAA+BP,YAAY,gBAAZ,EAA8B,IAA9B,CAA/B;;gBAEKhC,MAAL,CAAYwC,gBAAZ,CAA6BZ,OAAOC,GAAP,CAAWY,MAAX,CAAkBC,cAA/C,EAA+D,UAACC,KAAD,EAAW;gBACpEC,MAAMD,MAAME,MAAhB;gBACI,MAAKzC,aAAL,IAAsBwC,GAA1B,EAA+B;oBACxBxC,aAAL,CAAmB0C,eAAnB,CAAmC,EAAC,QAAQF,IAAIG,KAAJ,CAAUC,IAAnB,EAAnC;;WAHJ;SATF,MAgBK;cACGC,UAAUjB,YAAY,SAAZ,CAAhB;cACMkB,kBAAkBlB,YAAY,iBAAZ,CAAxB;;cAEI,CAACkB,eAAL,EACE,OAAOpC,QAAQF,KAAR,CAAP;;wBAEYsC,eAAd,GAAgCA,eAAhC;wBACcD,OAAd,GAAwBA,OAAxB;;;;YAIEE,gBAAgB,SAAhBA,aAAgB,CAACR,KAAD,EAAW;gBACxBS,MAAL,CAAYC,GAAZ,kCAA+CV,MAAMW,IAArD,EAA6DX,KAA7D;gBACKvC,aAAL,CAAmBmD,mBAAnB,CACE,CAACpC,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoCC,MAArC,EACCvC,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoCE,KADrC,CADF,EAGER,aAHF,EAIE,KAJF;;kBAMQR,MAAMW,IAAd;iBACOnC,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoCC,MAAzC;;oBAEQE,GAAN,GAAYjB,MAAMkB,aAAN,GAAsBC,GAAlC;;oBAEKV,MAAL,CAAYC,GAAZ,yCAAsDzC,MAAMgD,GAA5D;;iBAEGzC,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoCE,KAAzC;oBACOP,MAAL,CAAYC,GAAZ,CAAgB,wCAAhB,EAA0DV,KAA1D;;;kBAGI/B,KAAR;SAnBF;;cAsBKR,aAAL,CAAmBoC,gBAAnB,CACE,CAACrB,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoCC,MAArC,EACCvC,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoCE,KADrC,CADF,EAGER,aAHF,EAIE,KAJF;;;cAOK/C,aAAL,CAAmB2D,aAAnB,CAAiC7C,aAAjC;OA/EK,CAAP;KADF;;;;;;8BAqFQ;WACHkC,MAAL,CAAYC,GAAZ,CAAgB,8BAAhB;;;WAGKjD,aAAL,GAAqB,IAAIe,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmB0C,aAAvB,CAAqC,KAAKhE,MAAL,CAAYiE,YAAjD,CAArB;WACK7D,aAAL,CAAmB8D,eAAnB,CAAmC,KAAKlE,MAAL,CAAYmE,EAAZ,CAAeC,GAAf,CAAmBC,SAAtD;;;UAGMC,SAAS,EAAf;WACK,IAAI3B,KAAT,IAAkBxB,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAAjD,EAAuD;YACjDtC,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoCc,cAApC,CAAmD5B,KAAnD,CAAJ,EAA+D;iBACtD6B,IAAP,CAAYrD,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoCd,KAApC,CAAZ;;;WAGCvC,aAAL,CAAmBoC,gBAAnB,CAAoC8B,MAApC,EAA4C,KAAK9D,SAAjD,EAA4D,KAA5D;;;;oCAGc;WACTL,UAAL,GAAkB,KAAlB;;;;8BAGQwC,OAAO;WACVS,MAAL,CAAYC,GAAZ,2BAAwCV,MAAMW,IAA9C,EAAsDX,KAAtD;cACQA,MAAMW,IAAd;aACOnC,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoCgB,gBAAzC;eACOC,YAAL,CAAkB/B,KAAlB;;aAEGxB,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoCkB,cAAzC;eACOC,UAAL,CAAgBjC,KAAhB;;aAEGxB,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoCoB,OAAzC;eACOC,SAAL,CAAenC,KAAf;;aAEGxB,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoCsB,QAAzC;eACOC,OAAL,CAAarC,KAAb;;aAEGxB,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoCwB,WAAzC;eACOC,UAAL,CAAgBvC,KAAhB;;aAEGxB,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoC0B,KAAzC;eACOC,OAAL,CAAazC,KAAb;;aAEGxB,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoC4B,cAAzC;eACOC,eAAL,CAAqB3C,KAArB;;aAEGxB,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoC8B,QAAzC;eACOC,UAAL,CAAgB7C,KAAhB;;aAEGxB,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoCgC,cAAzC;eACOC,eAAL,CAAqB/C,KAArB;;aAEGxB,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoCkC,iBAAzC;eACOC,gBAAL,CAAsBjD,KAAtB;;aAEGxB,OAAOC,GAAP,CAAWC,GAAX,CAAeC,GAAf,CAAmBkC,WAAnB,CAA+BC,IAA/B,CAAoCE,KAAzC;eACOkC,OAAL,CAAalD,KAAb;;;;;;iCAKOA,OAAO;WACbxC,UAAL,GAAkB,IAAlB;WACK2F,aAAL,CAAmB,IAAIlE,OAAOC,GAAP,CAAWkE,KAAf,CAAqBnE,OAAOC,GAAP,CAAWmE,QAAX,CAAoBC,WAAzC,CAAnB;;;;8BAGQtD,OAAO;UACX,KAAKxC,UAAL,IAAmB,KAAvB,EACE,KAAKuE,YAAL;;UAEIwB,KAAKvD,MAAMwD,KAAN,EAAX;UACMC,eAAeF,GAAGG,eAAH,EAArB;UACMC,aAAaJ,GAAGK,YAAH,GAAkBC,aAAlB,EAAnB;UACMC,aAAaP,GAAGK,YAAH,GAAkBG,WAAlB,EAAnB;UACMC,SAAUF,cAAc,CAAf,GAAoB,SAApB,GAAkCA,cAAc,CAAC,CAAhB,GAAqB,UAArB,GAAkC,SAAlF;;WAEKpG,SAAL,GAAiB,IAAIuB,OAAOC,GAAP,CAAW+E,IAAf,CAAoBV,GAAGW,OAAH,EAApB,EAAkCX,GAAGY,QAAH,EAAlC,EAAiDZ,GAAGa,WAAH,EAAjD,EAAmET,UAAnE,EAA+EK,MAA/E,EAAuF,SAAvF,EAAkG,IAAlG,EAAwGP,YAAxG,EAAsH,IAAtH,EAA4HF,EAA5H,EAAgIA,GAAGK,YAAH,GAAkBS,WAAlB,EAAhI,CAAjB;WACKC,UAAL,GAAkBb,YAAlB;WACKN,aAAL,CAAmB,IAAIlE,OAAOC,GAAP,CAAWkE,KAAf,CAAqBnE,OAAOC,GAAP,CAAWmE,QAAX,CAAoBtC,MAAzC,EAAiD,KAAKrD,SAAtD,CAAnB;WACKyF,aAAL,CAAmB,IAAIlE,OAAOC,GAAP,CAAWkE,KAAf,CAAqBnE,OAAOC,GAAP,CAAWmE,QAAX,CAAoBkB,eAAzC,EAA0D,KAAK7G,SAA/D,CAAnB;WACKyF,aAAL,CAAmB,IAAIlE,OAAOC,GAAP,CAAWkE,KAAf,CAAqBnE,OAAOC,GAAP,CAAWmE,QAAX,CAAoBnB,OAAzC,EAAkD,KAAKxE,SAAvD,CAAnB;;;;oCAGcsC,OAAO;WAChBmD,aAAL,CAAmB,IAAIlE,OAAOC,GAAP,CAAWkE,KAAf,CAAqBnE,OAAOC,GAAP,CAAWmE,QAAX,CAAoBX,cAAzC,EAAyD,KAAKhF,SAA9D,CAAnB;;;;+BAGSsC,OAAO;WACXmD,aAAL,CAAmB,IAAIlE,OAAOC,GAAP,CAAWkE,KAAf,CAAqBnE,OAAOC,GAAP,CAAWmE,QAAX,CAAoBT,QAAzC,EAAmD,KAAKlF,SAAxD,CAAnB;;;;oCAGcsC,OAAO;WAChBmD,aAAL,CAAmB,IAAIlE,OAAOC,GAAP,CAAWkE,KAAf,CAAqBnE,OAAOC,GAAP,CAAWmE,QAAX,CAAoBP,cAAzC,EAAyD,KAAKpF,SAA9D,CAAnB;;;;4BAGMsC,OAAO;WACRmD,aAAL,CAAmB,IAAIlE,OAAOC,GAAP,CAAWkE,KAAf,CAAqBnE,OAAOC,GAAP,CAAWmE,QAAX,CAAoBmB,KAAzC,EAAgD,KAAK9G,SAArD,CAAnB;;;;+BAGSsC,OAAO;WACXxC,UAAL,GAAkB,KAAlB;WACK2F,aAAL,CAAmB,IAAIlE,OAAOC,GAAP,CAAWkE,KAAf,CAAqBnE,OAAOC,GAAP,CAAWmE,QAAX,CAAoBoB,SAAzC,CAAnB;UACI,KAAK7G,eAAL,IAAwB,KAAKA,eAAL,GAAuB,KAAKP,MAAL,CAAYiE,YAAZ,CAAyBoD,WAA5E,EAAyF;aAClFrH,MAAL,CAAYiE,YAAZ,CAAyBoD,WAAzB,GAAuC,KAAK9G,eAA5C;aACKA,eAAL,GAAuB,IAAvB;;;;;+BAIOoC,OAAO;UACV2E,iBAAiB3E,MAAMkB,aAAN,GAAsByD,cAA7C;UACMD,cAAcC,eAAeD,WAAnC;UACME,WAAWD,eAAeC,QAAhC;;WAEKzB,aAAL,CAAmB,IAAIlE,OAAOC,GAAP,CAAWkE,KAAf,CAAqBnE,OAAOC,GAAP,CAAWmE,QAAX,CAAoBwB,WAAzC,EAAsDH,WAAtD,CAAnB;WACKvB,aAAL,CAAmB,IAAIlE,OAAOC,GAAP,CAAWkE,KAAf,CAAqBnE,OAAOC,GAAP,CAAWmE,QAAX,CAAoByB,cAAzC,EAAyDC,KAAKC,KAAL,CAAWJ,WAAWF,WAAtB,CAAzD,CAAnB;;;;4BAGM1E,OAAO;UACT,CAAC,KAAK3C,MAAL,CAAY4H,MAAjB,EACE,KAAK5H,MAAL,CAAY6H,KAAZ;;WAEG/B,aAAL,CAAmB,IAAIlE,OAAOC,GAAP,CAAWkE,KAAf,CAAqBnE,OAAOC,GAAP,CAAWmE,QAAX,CAAoB8B,OAAzC,EAAkD,KAAKzH,SAAvD,CAAnB;;;;4BAGMsC,OAAO;WACRmD,aAAL,CAAmB,IAAIlE,OAAOC,GAAP,CAAWkE,KAAf,CAAqBnE,OAAOC,GAAP,CAAWmE,QAAX,CAAoBrC,KAAzC,EAAgDhB,MAAMkB,aAAN,GAAsBkE,YAAtE,CAAnB;;;;qCAGepF,OAAO;;;UAClB;YACIqF,OAAO,EAAb;cACMnE,aAAN,GAAsBoE,SAAtB,CAAgCC,OAAhC,CAAwC,UAACtF,GAAD,EAAS;eAC1C4B,IAAL,CAAU,EAAC,aAAa,OAAKpE,aAAL,CAAmB+H,wBAAnB,CAA4CvF,IAAIwF,KAAhD,CAAd,EAAV;SADF;YAGIJ,KAAKK,MAAT,EACE,KAAKrI,MAAL,CAAYgI,IAAZ,GAAmBA,IAAnB;OANJ,CAOE,OAAOM,KAAP,EAAc;;;;6BAGT3F,OAAO;UACR0E,cAAc,KAAKrH,MAAL,CAAYiE,YAAZ,CAAyBoD,WAA7C;UACMkB,mBAAmB,KAAKnI,aAAL,CAAmBoI,6BAAnB,CAAiDnB,WAAjD,CAAzB;UACIkB,oBAAoB,CAACA,iBAAiBE,MAA1C,EAAkD;aAC3ClI,eAAL,GAAuB8G,WAAvB;aACKrH,MAAL,CAAYiE,YAAZ,CAAyBoD,WAAzB,GAAuCkB,iBAAiBH,KAAxD;;;;;EAjP2BxG,OAAOC,GAAP,CAAW6G;;ACA5C9G,OAAOC,GAAP,CAAW8G,GAAX,CAAeC,cAAf,CAA8B,QAA9B,EAAwChH,OAAOC,GAAP,CAAWgH,MAAX,CAAkBC,aAAlB,CAAgC/I,GAAhC,CAAxC,EAEA;;;;"}