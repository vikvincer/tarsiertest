!function(e){"use strict";var a=function(e){function a(e,t){return babelHelpers.classCallCheck(this,a),babelHelpers.possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e,t))}return babelHelpers.inherits(a,e),babelHelpers.createClass(a,null,[{key:"create",value:function(e,t){var i=this;return window.AKAMAI_MEDIA_ANALYTICS_CONFIG_FILE_PATH=t.config,akamai.amp.AMP.addResources(t.sdk).then(function(){return babelHelpers.get(a.__proto__||Object.getPrototypeOf(a),"create",i).call(i,e,t)})}}]),babelHelpers.createClass(a,[{key:"setDimensions",value:function(e){var a=this.config.dimensions;for(var t in e){var i=e[t];null!=i&&(a[t]=i)}return this.applyDimensions(a),e}},{key:"applyDimensions",value:function(e){if("function"==typeof window.setAkamaiMediaAnalyticsData){try{for(var a in e)setAkamaiMediaAnalyticsData(a,this.player.evaluateBindings(e[a]))}catch(e){this.player.logger.error("[AMP MEDIA ANALYTICS ERROR]","Could not set dimensions:",e)}!1===this.config.iplookup&&"function"==typeof akamaiDisableServerIpLookup&&akamaiDisableServerIpLookup()}}},{key:"onready",value:function(e){try{!0===this.debug&&(window.AkamaiAnalytics_debug=1),window.akamaiSetVideoObject(this.player.mediaElement)}catch(e){this.player.logger.error("[AMP MEDIA ANALYTICS ERROR]","Could not set video tag",e)}var a=this.player.ads;null!=a&&(a.addEventListener("breakstart",this.onadbreakstart.bind(this)),a.addEventListener("breakend",this.onadbreakend.bind(this)),a.addEventListener("loaded",this.onadloaded.bind(this)),a.addEventListener("started",this.onadstarted.bind(this)),a.addEventListener("ended",this.onadended.bind(this)),a.addEventListener("firstquartile",this.onadfirstquartile.bind(this)),a.addEventListener("midpoint",this.onadmidpoint.bind(this)),a.addEventListener("thirdquartile",this.onadthirdquartile.bind(this)))}},{key:"onmediachange",value:function(e){var a=e.detail,t=null;"function"==typeof akamaiSetStreamURL&&akamaiSetStreamURL(a.src,!1);var i=this.config.viewerId||this.config.viewerID||this.config["std:viewerId"];null!=i&&"function"==typeof akamaiSetViewerId&&akamaiSetViewerId(i);var n=a.mediaanalytics;if(t=null!=n&&null!=n.dimensions?akamia.amp.Utils.override(this.config.dimensions,n.dimensions):this.config.dimensions,"function"==typeof akamaiHandleStreamSwitch)try{akamaiHandleStreamSwitch()}catch(e){}this.applyDimensions(t)}},{key:"updateMedia",value:function(e){"function"==typeof akamaiHandleTitleSwitch&&akamaiHandleTitleSwitch(e)}},{key:"onfragmentloadstart",value:function(e){"function"==typeof fragmentDownloadStarted&&fragmentDownloadStarted(e.detail)}},{key:"onfragmentloaded",value:function(e){"function"==typeof fragmentDownloadCompleted&&fragmentDownloadCompleted(e.detail)}},{key:"onbitratechange",value:function(e){"function"==typeof akamaiHandleBitRateSwitch&&akamaiHandleBitRateSwitch(e.detail.bitrate)}},{key:"onadbreakstart",value:function(){this.player.mediaElement.dataset.isad=!0}},{key:"onadbreakend",value:function(){this.player.mediaElement.dataset.isad=!1}},{key:"onadloaded",value:function(e){try{var a=e.data,t={adDuration:a.duration,adPartnerId:a.partner,adTitle:a.title,adId:a.id};"function"==typeof akamaiHandleAdLoaded&&akamaiHandleAdLoaded(t)}catch(e){this.player.logger.error("[AMP MEDIA ANALYTICS ERROR]",e)}}},{key:"onadstarted",value:function(){"function"==typeof akamaiHandleAdStarted&&akamaiHandleAdStarted()}},{key:"onadfirstquartile",value:function(){"function"==typeof akamaiHandleAdFirstQuartile&&akamaiHandleAdFirstQuartile()}},{key:"onadmidpoint",value:function(){"function"==typeof akamaiHandleAdMidpoint&&akamaiHandleAdMidpoint()}},{key:"onadthirdquartile",value:function(){"function"==typeof akamaiHandleAdThirdQuartile&&akamaiHandleAdThirdQuartile()}},{key:"onadended",value:function(){"function"==typeof akamaiHandleAdCompleted&&akamaiHandleAdCompleted(),this.player.getMediaElement().dataset.isad=!0}}]),a}(akamai.amp.Plugin),t=function(e){function a(e,t){babelHelpers.classCallCheck(this,a);var i=babelHelpers.possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e,t));return i.flashPlugins=[{id:"OSMFCSMALoader",host:"osmf",main:"com.akamai.playeranalytics.osmf.OSMFCSMALoaderInfo",type:"application/x-shockwave-flash"}],i.createDefaults(),i.player.addEventListener("createflashvars",i.createFlashVars.bind(i)),i.player.addEventListener("createxml",i.createXML.bind(i)),i}return babelHelpers.inherits(a,e),babelHelpers.createClass(a,[{key:"createDefaults",value:function(){this.player.createDefaults.call(this)}},{key:"setDimensions",value:function(e){return this.player.mediaElement.setPlayerProperty("maDimensions",e),e}},{key:"createFlashVars",value:function(e){var a=e.detail.flashvars,t=this.player.config&&this.player.config.media&&this.player.config.media.mediaanalytics;if(null!=t)for(var i in t)a["report_"+i]=t[i]}},{key:"createXML",value:function(e){var a=e.detail.xml,t=a.firstChild,i=a.getElementsByTagName("metrics")[0],n=null;null==i&&(i=a.createElement("metrics"),t.appendChild(i));var r=a.createElement("vendor");if(r.setAttribute("id","akamai"),i.appendChild(r),null!=this.config.config){n=a.createElement("property"),n.setAttribute("key","MEDIA_ANALYTICS_BEACON"),n.appendChild(akamai.amp.XMLUtils.createTextContent(a,this.config.config)),r.appendChild(n);var d=this.config.plugin.swf||"http://79423.analytics.edgesuite.net/csma/plugin/csma.swf";n=a.createElement("property"),n.setAttribute("key","MEDIA_ANALYTICS_PLUGIN_PATH"),n.appendChild(akamai.amp.XMLUtils.createTextContent(a,d)),r.appendChild(n)}if(null!=this.config.dimensions){var l=a.createElement("property");l.setAttribute("key","dimensions"),r.appendChild(l);for(var s in this.config.dimensions)n=a.createElement("property"),n.setAttribute("key",s),n.appendChild(akamai.amp.XMLUtils.createTextContent(a,this.config.dimensions[s])),l.appendChild(n)}}},{key:"onmediachange",value:function(e){var a=e.detail;if(a.mediaanalytics&&a.mediaanalytics.dimensions){a.dimensions=[];for(var t in a.mediaanalytics.dimensions)a.dimensions.push({key:t,value:a.mediaanalytics.dimensions[t]})}}}]),a}(akamai.amp.Plugin);akamai.amp.AMP.registerPlugin("mediaanalytics","html",a.factory),akamai.amp.AMP.registerPlugin("mediaanalytics","flash",t.factory),e.MediaAnalytics=a}(this.akamai.amp.mediaanalytics=this.akamai.amp.mediaanalytics||{});
//# sourceMappingURL=akamai/amp/mediaanalytics/Mediaanalytics.min.js.map