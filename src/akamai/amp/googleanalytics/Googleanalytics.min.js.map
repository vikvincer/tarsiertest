{"version":3,"sources":["../../../../src/GoogleAnalytics.js","../../../../src/main.js"],"names":["_this","type","eventName","config","events","filter","event","data","detail","key","value","player","cdim","Object","dim","dimValue","this","viewDuration","generateGoogleAnalyticsVO","obj","eventcategory","eventaction","eventlabel","eventvalue","customdimension","ads","onadended","started","currentTime","akamai","amp","Plugin","registerPlugin"],"mappings":"+QAIOA,2LAIgD,MAAhBC,MAC/BC,GAAAA,KAAaC,OACfC,OAAAH,kBAGEG,GAAAA,EAAJC,OACE,SAAAC,qCAEsCA,YACpCA,GAAAA,EAAJC,MACED,EAAAE,sBAGED,2CAGJ,GAAAE,KAAAF,GAAA,6CAIA,oBAAKE,EAAiB,IAChBC,GAAQ,GAAKC,YACbF,GAAAA,KAAQC,GAAA,IACNE,GAAWC,EAAfC,EACgBJ,kBAAXK,IAAkBA,EAAAC,KAAAC,uBACjBF,EAAWL,KACXK,GAAAA,IAGCD,+IAWSb,EAAgBe,KAAAE,0BAAAhB,EAAAD,0BAEzB,QACTkB,EAAAC,cAAAD,EAAAE,YAAAF,EAAAG,WAAAH,EAAAI,YAEsBH,MAArBD,EAAAK,qBAECL,GAAIK,KAAAA,GAAAA,mBAGH,MAALV,EAAgBK,6EAQZM,cACF,cAAA,gFAEiB,QAAAT,KAAeU,wFAM7BC,aAAL,OACKC,WAAL,6HAUID,SAAKA,yHAQHC,oBACFA,YAAcA,gLA/FuBC,IAAOC,IAAIC,eAAAA,kBAAAA,EAAAA,SCExDF,EAAOC,gBAAQE","file":"akamai/amp/googleanalytics/Googleanalytics.min.js","sourcesContent":["export default class GoogleAnalytics extends akamai.amp.Plugin {\n  constructor(player, config) {\n    super(player, config)\n\n    ga('create', this.config.trackingId, 'auto')\n    ga('send', 'pageview')\n  }\n\n  generateGoogleAnalyticsVO(eventName, type = \"video\") {\n    if (eventName == null)\n      return\n\n    const events = this.config.events[type]\n    if (events == null)\n      return\n\n    const event = events.filter((event) => (event != null && event.type == eventName))[0]\n    if (event == null)\n      return\n\n    const data = event.data || event.detail\n    if (data == null)\n      return\n\n    const vo = {\n      trackingid: this.config.trackingId\n    }\n\n    for (let key in data) {\n      let value = this.player.evaluateBindings(data[key])\n      if (key === \"customDimension\") {\n        let cdim = new Object()\n        for (let dim in value) {\n          let dimValue = value[dim]\n          if (dimValue === \"viewDuration\")\n            dimValue = this.viewDuration\n          ga(\"set\", dim, dimValue)\n          cdim[dim] = dimValue\n        }\n        value = cdim\n      }\n\n      vo[key.toLowerCase()] = value\n    }\n\n    return vo\n  }\n\n  trackEvent(eventName, type = \"video\") {\n    const obj = this.generateGoogleAnalyticsVO(eventName, type)\n    if (obj == null)\n      return\n\n    ga(\"send\", \"event\", obj.eventcategory, obj.eventaction, obj.eventlabel, obj.eventvalue)\n\n    if (obj.customdimension == null)\n      return\n\n    for (let dim in obj.customdimension) {\n      // TODO: Why is this being set to null? \"set\" is called in the VO function with a non-null value\n      ga(\"set\", dim, null)\n    }\n  }\n\n  onready() {\n    let ads = this.player.ads\n    if (ads == null)\n      return\n\n    this.bindHandlers([\"onadstarted\", \"onadended\"])\n    ads.addEventListener(\"started\", this.onadstarted)\n    ads.addEventListener(\"ended\", this.onadended)\n  }\n\n  onstarted() {\n    this.started = true\n    this.currentTime = 0\n    this.viewDuration = 0\n    this.trackEvent(\"started\")\n  }\n\n  onmediachange() {\n    this.onended()\n  }\n\n  onended() {\n    if (this.started === false)\n      return\n\n    this.started = false\n    this.trackEvent(\"ended\")\n  }\n\n  ontimeupdate(event) {\n    const currentTime = Math.round(event.detail)\n    if (currentTime > this.currentTime) {\n      this.viewDuration++\n      this.currentTime = currentTime\n    }\n  }\n\n  onadstarted(event) {\n    this.trackEvent(\"started\", \"ads\")\n  }\n\n  onadended(adVO) {\n    this.trackEvent(\"ended\", \"ads\")\n  }\n}\n","import GoogleAnalytics from \"./GoogleAnalytics.js\"\n\nakamai.amp.AMP.registerPlugin(\"googleanalytics\", GoogleAnalytics.factory)\n\nexport {GoogleAnalytics}\n"]}